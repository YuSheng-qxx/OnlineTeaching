"use strict";(self["webpackChunkcrm"]=self["webpackChunkcrm"]||[]).push([[810],{77810:function(e,o,a){a.r(o),a.d(o,{default:function(){return w}});var s=a(66252);const t={class:"login_container"},r={class:"login_box"},l=(0,s.Uk)(" CRM "),i=["src"],d=(0,s.Uk)("登录"),c={class:"add-box"},n=(0,s.Uk)("注册");function m(e,o,a,m,p,u){const g=(0,s.up)("el-col"),f=(0,s.up)("el-row"),h=(0,s.up)("el-input"),w=(0,s.up)("el-form-item"),v=(0,s.up)("el-button"),_=(0,s.up)("el-form"),y=(0,s.up)("create-popup");return(0,s.wg)(),(0,s.iD)("div",t,[(0,s._)("div",r,[(0,s.Wm)(f,{class:"logo-row"},{default:(0,s.w5)((()=>[(0,s.Wm)(g,{class:"logo-col"},{default:(0,s.w5)((()=>[l])),_:1})])),_:1}),(0,s.Wm)(_,{ref:"loginFormRef",class:"login_form",model:p.form,rules:p.formRules},{default:(0,s.w5)((()=>[(0,s.Wm)(w,{prop:"user_id",class:"login-email"},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{placeholder:"账户名",modelValue:p.form.user_id,"onUpdate:modelValue":o[0]||(o[0]=e=>p.form.user_id=e),modelModifiers:{trim:!0},class:"email-input"},null,8,["modelValue"])])),_:1}),(0,s.Wm)(w,{prop:"password",class:"password"},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{placeholder:"密码",modelValue:p.form.password,"onUpdate:modelValue":o[1]||(o[1]=e=>p.form.password=e),modelModifiers:{trim:!0},type:"password"},null,8,["modelValue"])])),_:1}),(0,s.Wm)(w,{prop:"vcode",class:"vcode"},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{placeholder:"验证码",modelValue:p.form.vcode,"onUpdate:modelValue":o[2]||(o[2]=e=>p.form.vcode=e),modelModifiers:{trim:!0}},null,8,["modelValue"]),(0,s._)("img",{src:p.vcodeImage,alt:"",class:"v-code-img",onClick:o[3]||(o[3]=(...e)=>u.verifycode&&u.verifycode(...e))},null,8,i)])),_:1}),(0,s.Wm)(w,{class:"login-button"},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{type:"primary",onClick:u.login,loading:p.loginLoading},{default:(0,s.w5)((()=>[d])),_:1},8,["onClick","loading"])])),_:1}),(0,s._)("div",c,[(0,s.Wm)(v,{class:"add-btn",type:"text",onClick:u.add},{default:(0,s.w5)((()=>[n])),_:1},8,["onClick"])])])),_:1},8,["model","rules"])]),(0,s.Wm)(y,{show:p.popupShow,"popup-type":p.popupType,action:p.createAction,onClose:o[4]||(o[4]=e=>p.popupShow=!1)},null,8,["show","popup-type","action"])])}var p=a(12223),u=a(36105),g={name:"LoginLayout",components:{CreatePopup:u.Z},data(){return{form:{user_id:"",password:"",captid:"",vcode:""},loginLoading:!1,vcodeImage:"",formRules:{user_id:[{required:!0,message:"请输入用户名",trigger:"change"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"change"}],vcode:[{required:!0,message:"请输入验证码",trigger:"change"}]},initialRoute:"/crm/customer",popupShow:!1,popupType:"CreateUser",createAction:{type:"add",id:"",data:{}}}},mounted(){this.verifycode()},methods:{verifycode(){(0,p.Yp)().then((e=>{e&&200===e.code?(this.form.captid=e.data.captid,this.vcodeImage=e.data.image):this.$message.error(e.error)})).catch((e=>{console.log(e)}))},login(){this.$refs.loginFormRef.validate((async e=>{e&&(this.loginLoading=!0,(0,p.x4)(this.form).then((e=>{if(e&&200===e.code){let o=e.data.authorization;localStorage.setItem("crmToken",o),localStorage.setItem("crmPermission",JSON.stringify({loginUser:e.data})),this.$store.commit("set_userInfo",e.data),this.$message.success("登录成功"),this.$router.push("/crm/customer")}else this.$message.warning(e.message)})).catch((()=>{})).finally((()=>{this.loginLoading=!1,this.verifycode()})))}))},add(){this.createAction=this.$options.data().createAction,this.popupShow=!0}}},f=a(83744);const h=(0,f.Z)(g,[["render",m],["__scopeId","data-v-353f72c6"]]);var w=h}}]);
//# sourceMappingURL=810.0caeaa5b.js.map